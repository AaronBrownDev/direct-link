# DirectLink SFU Configuration
# Optimized for ultra-low latency remote production

[sfu]
# Ballast memory in MB - helps with GC pressure under load
# Set to 0 for development, consider 128-512 for production
ballast = 0
# Enable stats collection for monitoring/debugging
withstats = true

[router]
# Maximum bandwidth per peer in bps (0 = unlimited)
# For 1080p60 NVENC streams, ~8-15 Mbps is typical
maxbandwidth = 15000000
# Maximum packets to track per session
maxpackettrack = 500
# Audio level detection interval in ms
audiolevelinterval = 1000
# Audio level threshold (0-127, lower = more sensitive)
audiolevelthreshold = 40
# Audio level filter (smoothing)
audiolevelfilter = 20

[router.simulcast]
# Start with best quality - important for director viewing
bestqualityfirst = true
# Temporal layer switching (experimental, keep false for stability)
enabletemporallayer = false

[webrtc]
# UDP port range for WebRTC traffic
# Ensure these are open in firewall/security groups
# Format: [min, max] where max - min >= 100
portrange = [5000, 5200]

# For single port mode (easier firewall config, slightly less efficient)
# Uncomment below and comment out portrange
# singleport = 5000

# SDP semantics - unified-plan is the modern standard
sdpsemantics = "unified-plan"

# Disable mDNS for cloud deployments (causes issues with containers)
mdns = false

# ICE servers for NAT traversal
# Google's public STUN server (free, reliable)
[[webrtc.iceserver]]
urls = ["stun:stun.l.google.com:19302"]

# Add TURN server for production (required when clients are behind strict NAT)
# You'll need to set up your own TURN server or use a service
# [[webrtc.iceserver]]
# urls = ["turn:your-turn-server.com:3478"]
# username = "directlink"
# credential = "your-secret-credential"

# For cloud deployments (GCP, AWS), set public IP
[webrtc.candidates]
# Uncomment and set your server's public IP for NAT traversal
# nat1to1 = ["YOUR_PUBLIC_IP"]
# Enable ICE lite for server-side (reduces ICE negotiation time)
# icelite = true

[webrtc.timeouts]
# Seconds without network activity before ICE is considered disconnected
disconnected = 5
# Seconds after disconnected before ICE is considered failed
failed = 25
# ICE keepalive interval in seconds
keepalive = 2

# Embedded TURN server (optional - use external TURN for production)
[turn]
enabled = false
realm = "directlink"
address = "0.0.0.0:3478"
# TLS certs for secure TURN
# cert = "/path/to/cert.pem"
# key = "/path/to/key.pem"

[turn.auth]
# Static credentials (simple, less secure)
# credentials = "username=password"
# Shared secret for time-limited credentials (recommended)
# secret = "your-turn-secret"

#Redis Configuration
[redis]
addr = "localhost:6379" # Where Redis is running
password = ""
db = 0 # Redis database number
pool_size = 10 #Max number of connections to keep open
min_idle_conns = 2 #Min number of connections to keep alive


[redis.timeouts]
dial = "5s"
read = "3s"
write = "3s"

#How long before keys automatically expire
[redis.ttl]
session = "24h"
peer = "1h"